# --
# Copyright (C) 2019-2021 Rother OSS GmbH, https://otobo.de/
# added for OTOBO (http://otobo.de/)
# --

# This configuration is the standard way for running OTOBO
# under Apache with SSL.
# Dynamic and static content is generated by the Plack app otobo.psgi.
# DEFLATE and support for HTTPS should be handled in separate configuration files.

# Please change here * to the server IP-address
<VirtualHost *:443>

    # Please change here the otobo admin mail address
    ServerAdmin mail@otobo.de

    # Please change here the FQDN or hostname, you like to use with OTOBO
    ServerName helpdesk.otobo.de

    # Please change here and add more different FQDNÂ´s or hostnames, you like to use with OTOBO
    ServerAlias www.helpdesk.otobo.de

    DocumentRoot /opt/otobo/var/httpd/htdocs
    HostnameLookups Off
    UseCanonicalName Off
    ServerSignature Off

    <IfModule mod_ssl.c>

        # Please load the ssl module before (On most linux systems use: "bash> a2enmod ssl")
        SSLEngine on

        # Please add the path to the ssl cert
        SSLCertificateFile /etc/ssl/certs/otobo.de.cert

        # Please add the path to the ssl key
        SSLCertificateKeyFile /etc/ssl/private/otobo.de.nopass.key

        # Please add the path to the ssl chain file (Download from used ssl cert publisher)
        SSLCertificateChainFile /etc/ssl/certs/linux_intermediate_otobo.ch.pem

    </IfModule>

    <IfModule mod_perl.c>

        # each site should have it's own Perl interpreter
        PerlOptions +Parent

        # @INC is also set on otobo.psgi, but this has not been reliable
        PerlSwitches -I /opt/otobo -I /opt/otobo/Kernel/cpan-lib -I /opt/otobo/Custom

        # everything is handled by the PSGI app
        <Location />

            # handle all requests, including the static content, with otobo.psgi
            SetHandler          perl-script
            PerlResponseHandler Plack::Handler::Apache2
            PerlSetVar          psgi_app /opt/otobo/bin/psgi-bin/otobo.psgi

            # Require is supported starting with Apache 2.4.
            # No authentication and all requests are allowed.
            Require all granted

    </Location>

</VirtualHost>

# Limit the number of requests per child to avoid excessive memory usage.
# 1000 is the same value as the default value used by Gazelle.
MaxRequestsPerChild 1000
